<!DOCTYPE html>
<html>
    <head>
	<script src="../lib/jquery/jquery-1.7.1.js"></script>

	<style> 
	    #sog{
	      margin:40px;
	    }

	    #btn_restart{
	      margin-left:40px;
	      width:200px;
	      height:50px;
	    }
	</style>

	<script>
	    function drawBall(x,y,w,h){
	      ctx.beginPath();
	      ctx.fillStyle = "green";
	      ctx.arc(x, y, w, h, Math.PI*2, true); 
	      ctx.closePath();
	      ctx.fill();
	      ctx.fillStyle = "black";
	      ctx.fillText("("+x+","+y+")", x, y);
	    }

	    function drawTarget(x,y,w,h){
	      ctx.beginPath();
	      ctx.fillStyle = "blue";
	      ctx.arc(x, y, w, h, Math.PI*2, true); 
	      ctx.closePath();
	      ctx.fill();
	      ctx.fillStyle = "black";
	      ctx.fillText("("+x+","+y+")", x, y);
	    }

	    function drawObs(x,y,w,h){
	      ctx.beginPath();
	      ctx.fillStyle = "yellow";
	      ctx.arc(x, y, w, h, Math.PI*2, true); 
	      ctx.closePath();
	      ctx.fill();
	      ctx.fillStyle = "black";
	      ctx.fillText("("+x+","+y+")", x, y);
	    }

	    function drawArrow(fromx, fromy, tox, toy){
	      ctx.beginPath();
	      var headlen = 10;   // length of head in pixels
	      var angle = Math.atan2(toy-fromy,tox-fromx);
	      ctx.moveTo(fromx, fromy);
	      ctx.lineTo(tox, toy);
	      ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/6),toy-headlen*Math.sin(angle-Math.PI/6));
	      ctx.moveTo(tox, toy);
	      ctx.lineTo(tox-headlen*Math.cos(angle+Math.PI/6),toy-headlen*Math.sin(angle+Math.PI/6));
	      ctx.stroke();
	    }

	    function drawRobot(x,y,w,h){
	      //ctx.fillStyle = "red";
	      //ctx.fillRect(x, y, w, h);
	      //ctx.fillStyle = "black";
	      //ctx.fillText("("+x+","+y+")", x, y);
	      ctx.beginPath();
	      ctx.fillStyle = "red";
	      ctx.arc(x, y, w, h, Math.PI*2, true); 
	      ctx.closePath();
	      ctx.fill();
	      ctx.fillStyle = "black";
	      ctx.fillText("("+x+","+y+")", x, y);

	      }

	      function updateMap(){
	      console.log("Updating ... ");
	      sog = document.getElementById("sog");
	      ctx = sog.getContext("2d");
	      ctx.clearRect ( 0, 0, 480, 480);

	      $.ajax({
	      url: 'server.php',
	      success: function(data) {
	      var json = jQuery.parseJSON(data);
	      $.each(json, function(key, val){
	      console.log(val);
	      //Print each obj to map
	      $.each(val, function(key2, val2){

	      if(val2.indexOf('r') != -1){
		// It's robot
		var position = val2.split("r");
		robotPosition = position;
		drawRobot(position[0], position[1], 20, 20);
	      }

	      if(val2.indexOf('b' != -1)){
		// It's ball
		var position = val2.split("b");
		drawBall(position[0], position[1], 7, 0);
	      }

	      if(val2.indexOf('o' != -1)){
		// It's obstacle
		var position = val2.split("o");
		drawObs(position[0], position[1], 14, 0);
	      }

	      if(val2.indexOf('t' != -1)){
		// It's target point
		var position = val2.split("t");
		drawTarget(position[0], position[1], 2, 0);
		drawArrow(robotPosition[0], robotPosition[1], position[0], position[1]);
	      }

	    });
	  });
	}
      });
    }

    function restart(){
      $.ajax({
	url: 'restart.php'
      });
    }

</script>
    </head>
    <body>

	<canvas id="sog" width="480" height="480" style="border:1px solid #c3c3c3;">
	Your browser does not support the HTML5 canvas tag.
	</canvas></br>

	<button onclick="restart();" id='btn_restart'>Restart</button>

	<script>
	    var sog;
	    var ctx;
	    var robotPosition;
	    setInterval("updateMap();", 750);
	</script>

    </body>
</html>



